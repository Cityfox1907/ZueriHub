<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Z√ºriHub ‚Äì Gastronomie Kanton Z√ºrich</title>
<script>window.GMAPS_KEY = 'AIzaSyB1djuoI4by6_R_FZRuLfSY3Yp2H6m2bcA';</script>
<script async defer id="gmaps-script"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,700;1,400&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#060608;--bg2:#0c0c10;--bg3:#111118;--bg4:#181822;--bg5:#1e1e2a;--card:#13131c;--card-h:#1a1a26;--card-b:1px solid #1f1f2e;--t1:#ededf4;--t2:#9898b0;--t3:#5c5c78;--t4:#3a3a50;--gold:#c9a84c;--gold2:#a88a3a;--gold3:rgba(201,168,76,.12);--red:#d44;--red3:rgba(221,68,68,.1);--green:#3daa5c;--green3:rgba(61,170,92,.1);--blue:#4c8cd4;--blue3:rgba(76,140,212,.1);--r:10px;--r2:14px;--r3:20px;--sh:0 2px 16px rgba(0,0,0,.5);--sh2:0 8px 40px rgba(0,0,0,.6);--ff:'Outfit',system-ui,sans-serif;--fd:'Playfair Display',Georgia,serif;--tr:.18s cubic-bezier(.4,0,.2,1)}
html{font-size:14px;scroll-behavior:smooth}
body{font-family:var(--ff);background:var(--bg);color:var(--t1);line-height:1.55;min-height:100vh;overflow-x:hidden}
a{color:var(--gold);text-decoration:none;transition:color var(--tr)}a:hover{color:var(--t1)}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--t4);border-radius:3px}
#loader{position:fixed;inset:0;z-index:9999;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;transition:opacity .5s}
#loader.out{opacity:0;pointer-events:none}
#loader h1{font-family:var(--fd);font-size:2.8rem;color:var(--gold);margin-bottom:.6rem}
#loader .bar{width:160px;height:2px;background:var(--t4);border-radius:1px;overflow:hidden}
#loader .fill{height:100%;background:var(--gold);animation:ld 1.2s ease forwards}
@keyframes ld{to{width:100%}}
.nav{position:fixed;top:0;left:0;right:0;z-index:200;height:56px;display:flex;align-items:center;justify-content:space-between;padding:0 1.6rem;background:rgba(6,6,8,.88);backdrop-filter:blur(24px);border-bottom:1px solid #1a1a28}
.nav-brand{font-family:var(--fd);font-size:1.5rem;color:var(--gold);cursor:pointer;display:flex;align-items:center;gap:.4rem}
.nav-brand i{font-style:italic;font-size:.85rem;color:var(--t3);font-family:var(--ff);font-weight:300}
.nav-ct{font-size:.72rem;color:var(--t4);letter-spacing:.04em}
.main{padding-top:56px;min-height:100vh}
.welcome{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:calc(100vh - 56px);text-align:center;padding:3rem 1.5rem;position:relative;overflow:hidden}
.welcome::before{content:'';position:absolute;width:600px;height:600px;border-radius:50%;background:radial-gradient(circle,rgba(201,168,76,.06) 0%,transparent 70%);top:50%;left:50%;transform:translate(-50%,-50%);pointer-events:none}
.welcome h1{font-family:var(--fd);font-size:4rem;color:var(--gold);font-weight:700;margin-bottom:.3rem}
.welcome h1 em{font-style:italic;opacity:.6}
.welcome p{color:var(--t2);font-size:1rem;max-width:500px;margin-bottom:2.5rem;font-weight:300}
.w-card{width:260px;padding:2.2rem 1.4rem;background:var(--card);border:var(--card-b);border-radius:var(--r2);cursor:pointer;transition:all var(--tr);text-align:center}
.w-card:hover{background:var(--card-h);border-color:var(--gold2);transform:translateY(-6px);box-shadow:var(--sh2)}
.w-card-icon{font-size:2.8rem;margin-bottom:.7rem}
.w-card-t{font-weight:700;font-size:1.05rem;margin-bottom:.25rem}
.w-card-s{font-size:.72rem;color:var(--t3);line-height:1.5}
.hub{display:none;padding:1.2rem 1.6rem 3rem}.hub.on{display:block}
.hub-head{display:flex;align-items:flex-end;justify-content:space-between;margin-bottom:1.2rem;flex-wrap:wrap;gap:.8rem}
.hub-title{font-family:var(--fd);font-size:2rem;color:var(--gold);font-weight:700}
.hub-count{font-size:.78rem;color:var(--t3)}
.filters{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:1rem;align-items:center}
.f-group{display:flex;flex-wrap:wrap;gap:.35rem;align-items:center}
.f-label{font-size:.65rem;text-transform:uppercase;letter-spacing:.08em;color:var(--t4);margin-right:.3rem;font-weight:600}
.f-chip{padding:.32rem .7rem;font-size:.72rem;font-weight:500;border:1px solid var(--t4);border-radius:20px;background:transparent;color:var(--t3);cursor:pointer;transition:all var(--tr);white-space:nowrap;font-family:var(--ff)}
.f-chip:hover{border-color:var(--gold2);color:var(--t2)}
.f-chip.on{border-color:var(--gold);background:var(--gold3);color:var(--gold)}
.f-chip.red.on{border-color:var(--red);background:var(--red3);color:var(--red)}
.f-sep{width:1px;height:20px;background:var(--t4);margin:0 .4rem}
.ctrl-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.2rem;gap:1rem;flex-wrap:wrap}
.sort-wrap{display:flex;align-items:center;gap:.6rem}
.sort-sel{padding:.35rem .6rem;font-size:.72rem;background:var(--bg3);color:var(--t1);border:1px solid var(--t4);border-radius:var(--r);cursor:pointer;font-family:var(--ff)}
.view-btns{display:flex;gap:.3rem}
.v-btn{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:var(--bg3);border:1px solid var(--t4);border-radius:var(--r);cursor:pointer;color:var(--t3);transition:all var(--tr);font-size:.85rem}
.v-btn:hover,.v-btn.on{border-color:var(--gold);color:var(--gold);background:var(--gold3)}
.mini-map-wrap{width:280px;height:180px;border-radius:var(--r2);overflow:hidden;border:1px solid var(--t4);flex-shrink:0;position:relative}
.mini-map-wrap .expand-btn{position:absolute;top:6px;right:6px;z-index:10;width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:rgba(6,6,8,.8);border:1px solid var(--t4);border-radius:6px;color:var(--t2);cursor:pointer;font-size:.75rem;transition:all var(--tr)}
.mini-map-wrap .expand-btn:hover{background:var(--gold3);border-color:var(--gold);color:var(--gold)}
.mini-map-wrap.expanded{position:fixed;inset:70px 1.5rem 1.5rem;width:auto;height:auto;z-index:150;border-radius:var(--r2)}
.grid{display:grid;gap:.8rem;grid-template-columns:repeat(auto-fill,minmax(280px,1fr))}
.grid.compact{grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:.6rem}
.bcard{background:var(--card);border:var(--card-b);border-radius:var(--r2);overflow:hidden;cursor:pointer;transition:all var(--tr);position:relative;display:flex;flex-direction:column}
.bcard:hover{background:var(--card-h);border-color:#2a2a3c;transform:translateY(-3px);box-shadow:var(--sh)}
.bcard.top-mark{border-left:3px solid var(--gold)}.bcard.bad-mark{border-left:3px solid var(--red)}
.bcard-photo{width:100%;height:130px;object-fit:cover;display:block;background:var(--bg3)}
.bcard-no-photo{width:100%;height:60px;background:linear-gradient(135deg,var(--bg3) 0%,var(--bg4) 100%);display:flex;align-items:center;justify-content:center;font-size:1.5rem;opacity:.3}
.bcard-body{padding:.8rem .9rem .9rem;flex:1;display:flex;flex-direction:column}
.bcard-top{display:flex;justify-content:space-between;align-items:flex-start;gap:.5rem;margin-bottom:.3rem}
.bcard-name{font-weight:700;font-size:.88rem;line-height:1.3;flex:1}
.bcard-rating{display:flex;align-items:center;gap:.2rem;flex-shrink:0}
.bcard-rating .val{font-weight:800;font-size:.9rem}
.bcard-rating .star{color:var(--gold);font-size:.75rem}
.bcard-addr{font-size:.7rem;color:var(--t3);margin-bottom:.5rem;line-height:1.4}
.bcard-footer{display:flex;align-items:center;gap:.5rem;margin-top:auto;flex-wrap:wrap}
.bcard-reviews{font-size:.68rem;color:var(--t3)}
.bcard-badge{font-size:.62rem;padding:.15rem .45rem;border-radius:10px;font-weight:600}
.bcard-badge.trade{background:var(--blue3);color:var(--blue)}
.bcard-badge.rank-top{background:var(--gold3);color:var(--gold)}
.bcard-badge.rank-bad{background:var(--red3);color:var(--red)}
.bcard-gmb{position:absolute;top:.5rem;right:.5rem;width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:rgba(6,6,8,.75);border-radius:50%;color:var(--t2);font-size:.7rem;opacity:0;transition:opacity var(--tr);z-index:5;border:1px solid transparent}
.bcard:hover .bcard-gmb{opacity:1}
.bcard-gmb:hover{background:var(--gold);color:var(--bg);border-color:var(--gold)}
.grid.list-view{grid-template-columns:1fr;gap:.3rem}
.grid.list-view .bcard{flex-direction:row;border-radius:var(--r)}
.grid.list-view .bcard-photo,.grid.list-view .bcard-no-photo{width:70px;height:auto;min-height:60px;border-radius:0;flex-shrink:0}
.grid.list-view .bcard-body{padding:.55rem .8rem;flex-direction:row;align-items:center;gap:1rem}
.grid.list-view .bcard-top{margin-bottom:0;flex:1}
.grid.list-view .bcard-addr{display:none}
.grid.list-view .bcard-footer{margin-top:0;flex-shrink:0}
.rankings-drawer{position:fixed;top:56px;right:0;bottom:0;width:340px;background:rgba(8,8,12,.95);backdrop-filter:blur(20px);border-left:1px solid var(--t4);z-index:160;transform:translateX(100%);transition:transform .3s ease;overflow-y:auto}
.rankings-drawer.open{transform:translateX(0)}
.rk-head{padding:1rem 1.2rem;border-bottom:1px solid var(--t4);display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;background:rgba(8,8,12,.95);backdrop-filter:blur(20px);z-index:2}
.rk-title{font-family:var(--fd);font-size:1.2rem;color:var(--gold)}
.rk-close{background:none;border:none;color:var(--t3);cursor:pointer;font-size:1.2rem;padding:.3rem}
.rk-body{padding:.8rem}
.rk-section{margin-bottom:1rem}
.rk-section-t{font-size:.68rem;text-transform:uppercase;letter-spacing:.08em;color:var(--t4);padding:.3rem .4rem;font-weight:600}
.rk-item{display:flex;align-items:center;gap:.5rem;padding:.4rem;border-radius:var(--r);cursor:pointer;transition:background var(--tr);font-size:.78rem}
.rk-item:hover{background:var(--bg4)}
.rk-pos{width:22px;height:22px;display:flex;align-items:center;justify-content:center;font-size:.65rem;font-weight:700;border-radius:50%;background:var(--gold3);color:var(--gold);flex-shrink:0}
.rk-pos.g1{background:var(--gold);color:var(--bg)}
.rk-name{flex:1;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.rk-val{color:var(--gold);font-weight:700}
.rk-toggle{position:fixed;bottom:1.5rem;right:1.5rem;z-index:155;padding:.6rem 1rem;font-size:.75rem;font-weight:600;background:var(--bg3);border:1px solid var(--gold2);border-radius:24px;color:var(--gold);cursor:pointer;font-family:var(--ff);transition:all var(--tr);display:none;box-shadow:var(--sh)}
.rk-toggle:hover{background:var(--gold3);transform:translateY(-2px)}
.rk-toggle.vis{display:flex;align-items:center;gap:.4rem}
.search-wrap{position:relative;margin-bottom:1rem}
.search-input{width:100%;padding:.6rem 1rem .6rem 2.4rem;font-size:.85rem;background:var(--bg3);color:var(--t1);border:1px solid var(--t4);border-radius:var(--r3);font-family:var(--ff);transition:border-color var(--tr);outline:none}
.search-input:focus{border-color:var(--gold2)}
.search-input::placeholder{color:var(--t4)}
.search-icon{position:absolute;left:.85rem;top:50%;transform:translateY(-50%);color:var(--t4);font-size:.8rem;pointer-events:none}
@media(max-width:768px){.hub{padding:1rem .8rem 2rem}.grid{grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:.5rem}.mini-map-wrap{width:100%;height:140px}.ctrl-row{flex-direction:column;align-items:stretch}.rankings-drawer{width:100%}.welcome h1{font-size:2.5rem}.nav{padding:0 .8rem}}
@keyframes cardIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.anim{animation:cardIn .25s ease forwards}
</style>
</head>
<body>
<div id="loader"><h1>Z√ºriHub</h1><div class="bar"><div class="fill"></div></div></div>
<nav class="nav">
  <div class="nav-brand" onclick="goHome()">Z√ºriHub <i>Gastronomie Kt. Z√ºrich</i></div>
  <div class="nav-ct" id="navCt"></div>
</nav>
<div class="main">
  <section class="welcome" id="welcomeView">
    <h1>Z√ºri<em>Hub</em></h1>
    <p>Das vollst√§ndige Gastronomie-Verzeichnis f√ºr den Kanton Z√ºrich. Alle Betriebe ab 40 Google-Bewertungen ‚Äì von 1 bis 5 Sterne, transparent filterbar.</p>
    <div class="w-card" onclick="openHub()">
      <div class="w-card-icon">üçΩÔ∏è</div>
      <div class="w-card-t">Gastronomie entdecken</div>
      <div class="w-card-s">Restaurant ¬∑ Bar ¬∑ Caf√© ¬∑ Takeaway ¬∑ B√§ckerei ¬∑ Hotel</div>
    </div>
  </section>
  <section class="hub" id="hubGastro">
    <div class="hub-head"><div><div class="hub-title">Gastronomie Kanton Z√ºrich</div><div class="hub-count" id="hubCount"></div></div></div>
    <div class="search-wrap"><span class="search-icon">‚åï</span><input class="search-input" id="searchInput" placeholder="Restaurant, Bar, Caf√© oder Adresse suchen‚Ä¶" oninput="onSearch()"></div>
    <div class="filters" id="filters"></div>
    <div class="ctrl-row">
      <div class="sort-wrap">
        <select class="sort-sel" id="sortSel" onchange="render()">
          <option value="rating-desc">Beste Bewertung</option>
          <option value="rating-asc">Schlechteste Bewertung</option>
          <option value="reviews-desc">Meiste Bewertungen</option>
          <option value="name-asc">Name A‚ÄìZ</option>
        </select>
        <div class="view-btns">
          <button class="v-btn on" onclick="setView('grid',this)">‚ñ¶</button>
          <button class="v-btn" onclick="setView('list',this)">‚ò∞</button>
          <button class="v-btn" onclick="setView('compact',this)">‚ñ™‚ñ™</button>
        </div>
      </div>
      <div class="mini-map-wrap" id="mapwrap">
        <button class="expand-btn" onclick="toggleMapExpand()">‚§¢</button>
        <div id="minimap" style="width:100%;height:100%"></div>
      </div>
    </div>
    <div class="grid" id="grid"></div>
  </section>
</div>
<div class="rankings-drawer" id="rkDrawer">
  <div class="rk-head"><div class="rk-title">üèÜ Ranglisten</div><button class="rk-close" onclick="toggleRankings()">‚úï</button></div>
  <div class="rk-body" id="rkBody"></div>
</div>
<button class="rk-toggle" id="rkToggle" onclick="toggleRankings()">üèÜ Ranglisten</button>
<script>
const S={map:null,markers:[],data:null,filtered:[],tradeFilter:new Set(),ratingFilter:null,viewMode:'grid',searchQuery:'',mapsReady:false,rkOpen:false};
function stars(r){const f=Math.floor(r);const h=r-f>=.3;let s='';for(let i=0;i<f;i++)s+='‚òÖ';if(h)s+='¬Ω';return s}
function ratingColor(r){if(r>=4.5)return'var(--gold)';if(r>=3.5)return'var(--green)';if(r>=2.5)return'var(--t2)';return'var(--red)'}
function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML}
function goHome(){document.getElementById('welcomeView').style.display='';document.getElementById('hubGastro').classList.remove('on');document.getElementById('navCt').textContent='';document.getElementById('rkToggle').classList.remove('vis');closeRankings()}
async function openHub(){document.getElementById('welcomeView').style.display='none';document.getElementById('hubGastro').classList.add('on');document.getElementById('rkToggle').classList.add('vis');if(S.data)return;document.getElementById('grid').innerHTML='<div style="padding:3rem;text-align:center;color:var(--t3)">Lade Daten‚Ä¶</div>';try{const r=await fetch('data/gastro.json');if(!r.ok)throw 0;S.data=await r.json()}catch(e){S.data=genDemo()}S.tradeFilter.clear();S.ratingFilter=null;S.viewMode='grid';S.searchQuery='';document.getElementById('navCt').textContent=S.data.metadata.totalResults+' Betriebe ¬∑ Kt. Z√ºrich';buildFilters();applyFilters();initMiniMap();buildRankings()}
function buildFilters(){const c=document.getElementById('filters');const places=S.data.places;const trades={};places.forEach(p=>{trades[p.trade]=(trades[p.trade]||0)+1});const sorted=Object.entries(trades).sort((a,b)=>b[1]-a[1]);let h='<div class="f-group"><span class="f-label">Kategorie</span>';h+=`<button class="f-chip on" id="fall" onclick="clearTradeFilter()">Alle (${places.length})</button>`;sorted.forEach(([t,n])=>{h+=`<button class="f-chip" data-trade="${esc(t)}" onclick="toggleTrade('${esc(t)}',this)">${esc(t)} (${n})</button>`});h+='</div><div class="f-sep"></div><div class="f-group"><span class="f-label">Sterne</span>';h+='<button class="f-chip" data-rt="4.5" onclick="toggleRating(4.5,this)">‚òÖ 4.5+</button>';h+='<button class="f-chip" data-rt="4" onclick="toggleRating(4,this)">‚òÖ 4+</button>';h+='<button class="f-chip" data-rt="3" onclick="toggleRating(3,this)">‚òÖ 3+</button>';h+='<button class="f-chip" data-rt="2" onclick="toggleRating(2,this)">‚òÖ 2+</button>';h+='<button class="f-chip red" data-rt="0" onclick="toggleRating(0,this)">‚òÖ < 2</button></div>';c.innerHTML=h}
function clearTradeFilter(){S.tradeFilter.clear();document.querySelectorAll('#filters .f-chip[data-trade]').forEach(c=>c.classList.remove('on'));document.getElementById('fall').classList.add('on');applyFilters()}
function toggleTrade(trade,el){if(S.tradeFilter.has(trade)){S.tradeFilter.delete(trade);el.classList.remove('on')}else{S.tradeFilter.add(trade);el.classList.add('on');document.getElementById('fall').classList.remove('on')}if(S.tradeFilter.size===0)document.getElementById('fall').classList.add('on');applyFilters()}
function toggleRating(level,el){const w=el.classList.contains('on');document.querySelectorAll('#filters .f-chip[data-rt]').forEach(c=>c.classList.remove('on'));if(w){S.ratingFilter=null}else{S.ratingFilter=level;el.classList.add('on')}applyFilters()}
function onSearch(){S.searchQuery=document.getElementById('searchInput').value.toLowerCase().trim();applyFilters()}
function applyFilters(){let p=[...S.data.places];if(S.tradeFilter.size>0)p=p.filter(x=>S.tradeFilter.has(x.trade));if(S.ratingFilter!==null){if(S.ratingFilter===0)p=p.filter(x=>x.rating<2);else p=p.filter(x=>x.rating>=S.ratingFilter)}if(S.searchQuery)p=p.filter(x=>x.name.toLowerCase().includes(S.searchQuery)||x.address.toLowerCase().includes(S.searchQuery)||x.trade.toLowerCase().includes(S.searchQuery));S.filtered=p;render()}
function render(){let p=S.filtered;const sv=document.getElementById('sortSel').value;const cmp={'rating-desc':(a,b)=>b.rating-a.rating||b.reviewCount-a.reviewCount,'rating-asc':(a,b)=>a.rating-b.rating||b.reviewCount-a.reviewCount,'reviews-desc':(a,b)=>b.reviewCount-a.reviewCount,'name-asc':(a,b)=>a.name.localeCompare(b.name,'de')};p.sort(cmp[sv]||cmp['rating-desc']);document.getElementById('hubCount').textContent=p.length+' von '+S.data.places.length+' Betrieben';const rk=S.data.rankings||{};const topIds=new Set(),badIds=new Set();Object.values(rk).forEach(r=>{(r.top_rated||[]).forEach(id=>topIds.add(id));(r.worst_rated||[]).forEach(id=>badIds.add(id))});const grid=document.getElementById('grid');grid.className='grid'+(S.viewMode==='list'?' list-view':'')+(S.viewMode==='compact'?' compact':'');const MAX=200;const show=p.slice(0,MAX);let h='';show.forEach((pl,i)=>{const isTop=topIds.has(pl.id),isBad=badIds.has(pl.id);const cls=['bcard','anim'];if(isTop)cls.push('top-mark');if(isBad)cls.push('bad-mark');const photo=pl.photos&&pl.photos[0]?`<img class="bcard-photo" src="${esc(pl.photos[0])}" alt="" loading="lazy" onerror="this.outerHTML='<div class=bcard-no-photo>üìç</div>'">`:'<div class="bcard-no-photo">üìç</div>';const gmb=pl.gmapsUrl||'#';h+=`<div class="${cls.join(' ')}" style="animation-delay:${Math.min(i*.015,.4)}s" onclick="window.open('${esc(gmb)}','_blank')"><a class="bcard-gmb" href="${esc(gmb)}" target="_blank" rel="noopener" onclick="event.stopPropagation()">‚Üó</a>${photo}<div class="bcard-body"><div class="bcard-top"><div class="bcard-name">${esc(pl.name)}</div><div class="bcard-rating"><span class="star" style="color:${ratingColor(pl.rating)}">${stars(pl.rating)}</span> <span class="val" style="color:${ratingColor(pl.rating)}">${pl.rating.toFixed(1)}</span></div></div><div class="bcard-addr">${esc(pl.address)}</div><div class="bcard-footer"><span class="bcard-reviews">${pl.reviewCount.toLocaleString('de-CH')} Bewertungen</span><span class="bcard-badge trade">${esc(pl.trade)}</span>${isTop?'<span class="bcard-badge rank-top">TOP</span>':''}${isBad?'<span class="bcard-badge rank-bad">WARNUNG</span>':''}</div></div></div>`});if(p.length>MAX)h+=`<div style="grid-column:1/-1;text-align:center;padding:1.5rem"><button class="f-chip" onclick="renderAll()" style="font-size:.85rem;padding:.5rem 1.2rem">Alle ${p.length} laden</button></div>`;if(p.length===0)h='<div style="grid-column:1/-1;padding:3rem;text-align:center;color:var(--t3)">Keine Betriebe gefunden.</div>';grid.innerHTML=h;renderMapMarkers()}
function renderAll(){const p=S.filtered;const rk=S.data.rankings||{};const topIds=new Set(),badIds=new Set();Object.values(rk).forEach(r=>{(r.top_rated||[]).forEach(id=>topIds.add(id));(r.worst_rated||[]).forEach(id=>badIds.add(id))});const grid=document.getElementById('grid');let h='';p.forEach(pl=>{const isTop=topIds.has(pl.id),isBad=badIds.has(pl.id);const cls=['bcard'];if(isTop)cls.push('top-mark');if(isBad)cls.push('bad-mark');const photo=pl.photos&&pl.photos[0]?`<img class="bcard-photo" src="${esc(pl.photos[0])}" alt="" loading="lazy" onerror="this.outerHTML='<div class=bcard-no-photo>üìç</div>'">`:'<div class="bcard-no-photo">üìç</div>';const gmb=pl.gmapsUrl||'#';h+=`<div class="${cls.join(' ')}" onclick="window.open('${esc(gmb)}','_blank')"><a class="bcard-gmb" href="${esc(gmb)}" target="_blank" rel="noopener" onclick="event.stopPropagation()">‚Üó</a>${photo}<div class="bcard-body"><div class="bcard-top"><div class="bcard-name">${esc(pl.name)}</div><div class="bcard-rating"><span class="star" style="color:${ratingColor(pl.rating)}">${stars(pl.rating)}</span> <span class="val" style="color:${ratingColor(pl.rating)}">${pl.rating.toFixed(1)}</span></div></div><div class="bcard-addr">${esc(pl.address)}</div><div class="bcard-footer"><span class="bcard-reviews">${pl.reviewCount.toLocaleString('de-CH')} Bewertungen</span><span class="bcard-badge trade">${esc(pl.trade)}</span>${isTop?'<span class="bcard-badge rank-top">TOP</span>':''}${isBad?'<span class="bcard-badge rank-bad">WARNUNG</span>':''}</div></div></div>`});grid.innerHTML=h}
function setView(mode,btn){S.viewMode=mode;btn.closest('.view-btns').querySelectorAll('.v-btn').forEach(b=>b.classList.remove('on'));btn.classList.add('on');render()}
function initMiniMap(){if(!S.mapsReady||S.map)return;S.map=new google.maps.Map(document.getElementById('minimap'),{center:{lat:47.3769,lng:8.5417},zoom:10,styles:[{elementType:"geometry",stylers:[{color:"#14141e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#14141e"}]},{elementType:"labels.text.fill",stylers:[{color:"#444466"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#1e1e30"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#0a0a14"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#252538"}]}],disableDefaultUI:true,zoomControl:true,gestureHandling:'cooperative'});renderMapMarkers()}
function renderMapMarkers(){if(!S.map)return;S.markers.forEach(m=>m.setMap(null));S.markers=[];const bounds=new google.maps.LatLngBounds();const max=Math.min(S.filtered.length,500);for(let i=0;i<max;i++){const pl=S.filtered[i];if(!pl.lat||!pl.lng)continue;const pos={lat:pl.lat,lng:pl.lng};bounds.extend(pos);let c;if(pl.rating>=4.5)c='#c9a84c';else if(pl.rating>=3.5)c='#3daa5c';else if(pl.rating>=2)c='#aaa';else c='#d44';const m=new google.maps.Marker({position:pos,map:S.map,title:pl.name,icon:{path:google.maps.SymbolPath.CIRCLE,scale:5,fillColor:c,fillOpacity:.85,strokeColor:'#000',strokeWeight:1}});m.addListener('click',()=>window.open(pl.gmapsUrl||'#','_blank'));S.markers.push(m)}if(max>0)S.map.fitBounds(bounds,20)}
function toggleMapExpand(){document.getElementById('mapwrap').classList.toggle('expanded');setTimeout(()=>{if(S.map)google.maps.event.trigger(S.map,'resize')},100)}
function toggleRankings(){S.rkOpen=!S.rkOpen;document.getElementById('rkDrawer').classList.toggle('open',S.rkOpen)}
function closeRankings(){S.rkOpen=false;document.getElementById('rkDrawer').classList.remove('open')}
function buildRankings(){const body=document.getElementById('rkBody');const rk=S.data.rankings||{};const pm={};S.data.places.forEach(p=>{pm[p.id]=p});let h='';Object.entries(rk).sort((a,b)=>b[1].total-a[1].total).forEach(([trade,d])=>{if(d.total<2)return;h+=`<div class="rk-section"><div class="rk-section-t">üèÜ ${esc(trade)}</div>`;(d.top_rated||[]).slice(0,5).forEach((id,i)=>{const p=pm[id];if(!p)return;h+=`<div class="rk-item" onclick="window.open('${esc(p.gmapsUrl||'#')}','_blank')"><div class="rk-pos ${i===0?'g1':''}">${i+1}</div><div class="rk-name">${esc(p.name)}</div><div class="rk-val">${p.rating.toFixed(1)} ‚òÖ</div></div>`});h+='</div>'});body.innerHTML=h||'<div style="padding:2rem;color:var(--t3);text-align:center">Keine Rankings</div>'}
function genDemo(){const zh=[{d:"Z√ºrich",la:47.3769,lo:8.5417},{d:"Winterthur",la:47.4975,lo:8.7290},{d:"Uster",la:47.3472,lo:8.7217},{d:"Dietikon",la:47.4045,lo:8.4001},{d:"B√ºlach",la:47.5200,lo:8.5400},{d:"Horgen",la:47.2590,lo:8.5980},{d:"Kloten",la:47.4514,lo:8.5849},{d:"W√§denswil",la:47.2300,lo:8.6690},{d:"Schlieren",la:47.3970,lo:8.4480},{d:"Regensdorf",la:47.4330,lo:8.4690}];const names={Restaurant:["Kronenhalle","Zeughauskeller","Hiltl","Clouds","Le D√©zaley","Alpenrose","Raclette Stube","Helvetia","Brasserie Lipp","Bindella","Holy Cow","Thai Garden","Zum Kropf","Volkshaus","Casa Ferlin","Sonnenberg","Rigiblick","Zunfthaus zur Waag","Markthalle","Rosaly's","Razzia","Nooba","Miss Miu","Maison Manesse","Frau Gerolds Garten","LaSalle","Neni","Igniv","Spaghetti Factory"],Bar:["Bar am Wasser","Old Crow","Widder Bar","Dante","Tales Bar","Shamrock","Clouds Bar","Jade Bar","Fritz","Gerold Bar","Kasheme","Hive","Jules Verne","Cinchona","Nietturm"],"Caf√©":["Spr√ºngli","Schober","Caf√© Odeon","Kafi Dihei","Milchbar","Vicaf√©","Mame","Henrici","Bor√©al Coffee","Mir√≥","Nini","Wunderbar","Xocolat"],Takeaway:["Yooji's","Negishi","Sternen Grill","Poke House","Dean & David","√Ñss-Bar","Kebab Station","Falafel King","Ramen Shop","Wok Star"],"B√§ckerei":["Buchmann","Stocker","Fleischli","Steiner Beck","John Baker","Sutter Begg","Hausb√§ckerei","Brotmacher","Ofenfrisch","Pane Vivo"],Hotel:["Baur au Lac","Dolder Grand","Widder Hotel","Storchen","Schweizerhof","Marriott","Hyatt","25hours","Park Hyatt","B2 Boutique"]};const places=[];let idx=0;Object.entries(names).forEach(([trade,list])=>{list.forEach(name=>{const loc=zh[Math.floor(Math.random()*zh.length)];places.push({id:`d${idx}`,name,address:`${['Bahnhof','Limmat','See','Berg','Kirch','Markt','Haupt','L√∂wen'][Math.floor(Math.random()*8)]}strasse ${1+Math.floor(Math.random()*99)}, ${8000+Math.floor(Math.random()*99)} ${loc.d}`,lat:loc.la+(Math.random()-.5)*.04,lng:loc.lo+(Math.random()-.5)*.06,rating:Math.round((1+Math.random()*4)*10)/10,reviewCount:40+Math.floor(Math.random()*3000),gmapsUrl:`https://www.google.com/maps/search/${encodeURIComponent(name+' '+loc.d+' Z√ºrich')}`,website:'',phone:'',photos:[],trade,types:[],hours:[],businessStatus:'OPERATIONAL'});idx++})});const rankings={};[...new Set(places.map(p=>p.trade))].forEach(trade=>{const tp=places.filter(p=>p.trade===trade);const best=[...tp].sort((a,b)=>b.rating-a.rating||b.reviewCount-a.reviewCount);const worst=[...tp].sort((a,b)=>a.rating-b.rating);const most=[...tp].sort((a,b)=>b.reviewCount-a.reviewCount);rankings[trade]={total:tp.length,top_rated:best.slice(0,10).map(p=>p.id),worst_rated:worst.slice(0,10).map(p=>p.id),most_reviewed:most.slice(0,10).map(p=>p.id)}});return{metadata:{generated:new Date().toISOString(),minReviews:40,region:'Kanton Z√ºrich',category:'gastro',totalResults:places.length},rankings,places}}
const _f=window.fetch;window.fetch=async function(u,...a){try{const r=await _f(u,...a);if(r.ok)return r;throw 0}catch(e){if(String(u).includes('gastro.json'))return new Response(JSON.stringify(genDemo()),{status:200,headers:{'Content-Type':'application/json'}});throw e}};
function initGMaps(){document.getElementById('gmaps-script').src=`https://maps.googleapis.com/maps/api/js?key=${window.GMAPS_KEY}&callback=onMapsReady`}
window.onMapsReady=function(){S.mapsReady=true;if(S.data)initMiniMap();setTimeout(()=>document.getElementById('loader').classList.add('out'),800)};
document.addEventListener('DOMContentLoaded',initGMaps);
</script>
</body>
</html>
