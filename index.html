<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Z√ºriHub ‚Äì Gastronomie Kanton Z√ºrich</title>
<script>window.GMAPS_KEY='AIzaSyB1djuoI4by6_R_FZRuLfSY3Yp2H6m2bcA';</script>
<script async defer id="gms"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Fraunces:ital,opsz,wght@0,9..144,700;1,9..144,400&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
--bg:#050507;--bg2:#0a0a0f;--bg3:#0f0f16;--bg4:#16161f;--bg5:#1c1c28;
--card:#0e0e17;--card-h:#141420;--card-b:#1a1a2a;
--t1:#eeeef5;--t2:#9494ad;--t3:#5e5e78;--t4:#3c3c52;
--gold:#d4a84a;--gold2:#b08a38;--gold3:rgba(212,168,74,.1);--gold4:rgba(212,168,74,.04);
--red:#e05555;--red3:rgba(224,85,85,.08);
--green:#45b468;--green3:rgba(69,180,104,.08);
--blue:#5090d0;--blue3:rgba(80,144,208,.08);
--orange:#d4864a;--orange3:rgba(212,134,74,.08);
--r:8px;--r2:12px;--r3:20px;
--sh:0 1px 8px rgba(0,0,0,.4);--sh2:0 6px 24px rgba(0,0,0,.5);
--ff:'Plus Jakarta Sans',system-ui,sans-serif;
--fd:'Fraunces',Georgia,serif;
--tr:.16s cubic-bezier(.4,0,.2,1);
}
html{font-size:13.5px;scroll-behavior:smooth}
body{font-family:var(--ff);background:var(--bg);color:var(--t1);line-height:1.55;min-height:100vh}
a{color:var(--gold);text-decoration:none}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--t4);border-radius:2px}

/* Loader */
#LD{position:fixed;inset:0;z-index:9999;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;transition:opacity .4s}
#LD.out{opacity:0;pointer-events:none}
#LD h1{font-family:var(--fd);font-size:2.4rem;color:var(--gold);margin-bottom:.5rem}
#LD .b{width:140px;height:2px;background:var(--t4);border-radius:1px;overflow:hidden}
#LD .f{height:100%;background:var(--gold);animation:ldf 1s ease forwards}
@keyframes ldf{to{width:100%}}

/* Nav */
.nav{position:fixed;top:0;left:0;right:0;z-index:200;height:52px;display:flex;align-items:center;justify-content:space-between;padding:0 1.4rem;background:rgba(5,5,7,.9);backdrop-filter:blur(20px);border-bottom:1px solid #151520}
.nav-brand{font-family:var(--fd);font-size:1.35rem;color:var(--gold);cursor:pointer}
.nav-brand span{font-family:var(--ff);font-size:.7rem;color:var(--t3);margin-left:.5rem;font-weight:400;letter-spacing:.04em}
.nav-r{display:flex;align-items:center;gap:1rem}
.nav-stat{font-size:.68rem;color:var(--t4)}

/* Layout */
.app{padding-top:52px;display:flex;min-height:100vh}

/* Sidebar filters */
.sidebar{width:260px;background:var(--bg2);border-right:1px solid #151520;display:flex;flex-direction:column;position:fixed;top:52px;bottom:0;left:0;overflow-y:auto;z-index:50;transition:transform .3s ease}
.sidebar.closed{transform:translateX(-260px)}
.sb-toggle{position:fixed;top:58px;left:6px;z-index:55;width:30px;height:30px;display:none;align-items:center;justify-content:center;background:var(--bg3);border:1px solid var(--t4);border-radius:var(--r);color:var(--t2);cursor:pointer;font-size:.8rem}

.sb-section{padding:.8rem 1rem;border-bottom:1px solid #151520}
.sb-title{font-size:.62rem;text-transform:uppercase;letter-spacing:.1em;color:var(--t4);font-weight:700;margin-bottom:.5rem;display:flex;align-items:center;justify-content:space-between}
.sb-title .ct{color:var(--gold);font-weight:600}
.sb-search{width:100%;padding:.45rem .7rem;font-size:.78rem;background:var(--bg3);color:var(--t1);border:1px solid #1a1a2a;border-radius:var(--r);font-family:var(--ff);outline:none;transition:border-color var(--tr)}
.sb-search:focus{border-color:var(--gold2)}
.sb-search::placeholder{color:var(--t4)}

.sb-chips{display:flex;flex-wrap:wrap;gap:.3rem}
.chip{padding:.25rem .55rem;font-size:.68rem;font-weight:500;border:1px solid #1e1e2e;border-radius:16px;background:transparent;color:var(--t3);cursor:pointer;transition:all var(--tr);font-family:var(--ff);white-space:nowrap}
.chip:hover{border-color:var(--gold2);color:var(--t2)}
.chip.on{border-color:var(--gold);background:var(--gold3);color:var(--gold)}
.chip.red.on{border-color:var(--red);background:var(--red3);color:var(--red)}
.chip .n{font-size:.6rem;opacity:.5;margin-left:.15rem}

.sb-clear{font-size:.62rem;color:var(--gold2);cursor:pointer;font-weight:500}
.sb-clear:hover{color:var(--gold)}

/* Content area */
.content{margin-left:260px;flex:1;display:flex;flex-direction:column;min-height:calc(100vh - 52px)}

/* Top bar */
.topbar{padding:.7rem 1.2rem;display:flex;align-items:center;justify-content:space-between;gap:.8rem;border-bottom:1px solid #151520;background:var(--bg);position:sticky;top:52px;z-index:40;flex-wrap:wrap}
.topbar-l{display:flex;align-items:center;gap:.8rem}
.topbar-count{font-size:.82rem;font-weight:700;color:var(--t1)}
.topbar-count span{color:var(--t3);font-weight:400}
.topbar-r{display:flex;align-items:center;gap:.5rem}
.sort-sel{padding:.3rem .5rem;font-size:.7rem;background:var(--bg3);color:var(--t1);border:1px solid #1e1e2e;border-radius:var(--r);cursor:pointer;font-family:var(--ff)}
.vbtn{width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:var(--bg3);border:1px solid #1e1e2e;border-radius:var(--r);cursor:pointer;color:var(--t3);transition:all var(--tr);font-size:.75rem}
.vbtn:hover,.vbtn.on{border-color:var(--gold);color:var(--gold);background:var(--gold3)}

/* Mini map */
.minimap-wrap{height:160px;border-bottom:1px solid #151520;position:relative;flex-shrink:0;display:none}
.minimap-wrap.vis{display:block}
.minimap-wrap .exp{position:absolute;top:6px;right:6px;z-index:10;width:26px;height:26px;display:flex;align-items:center;justify-content:center;background:rgba(5,5,7,.8);border:1px solid var(--t4);border-radius:6px;color:var(--t2);cursor:pointer;font-size:.7rem}
.minimap-wrap.big{position:fixed;inset:56px 0 0 260px;height:auto;z-index:45;border:none}
#mmap{width:100%;height:100%}

/* List */
.list-wrap{flex:1;overflow-y:auto;padding:0}

/* Row item */
.row{display:flex;align-items:center;padding:.55rem 1.2rem;border-bottom:1px solid #0e0e18;cursor:pointer;transition:background var(--tr);gap:.8rem}
.row:hover{background:var(--bg3)}
.row-rank{width:28px;font-size:.68rem;font-weight:700;color:var(--t4);text-align:center;flex-shrink:0}
.row-photo{width:44px;height:44px;border-radius:var(--r);object-fit:cover;background:var(--bg4);flex-shrink:0}
.row-no-photo{width:44px;height:44px;border-radius:var(--r);background:var(--bg4);display:flex;align-items:center;justify-content:center;font-size:1rem;opacity:.2;flex-shrink:0}
.row-info{flex:1;min-width:0}
.row-name{font-weight:700;font-size:.82rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.row-addr{font-size:.66rem;color:var(--t3);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.row-badges{display:flex;gap:.3rem;margin-top:.15rem;flex-wrap:wrap}
.badge{font-size:.58rem;padding:.1rem .4rem;border-radius:8px;font-weight:600}
.badge-cat{background:var(--blue3);color:var(--blue)}
.badge-cuisine{background:var(--orange3);color:var(--orange)}
.badge-loc{background:var(--green3);color:var(--green)}
.badge-top{background:var(--gold3);color:var(--gold)}
.badge-bad{background:var(--red3);color:var(--red)}
.row-rating{display:flex;flex-direction:column;align-items:flex-end;flex-shrink:0;gap:.05rem}
.row-stars{font-weight:800;font-size:.88rem}
.row-reviews{font-size:.6rem;color:var(--t3)}
.row-gmb{width:26px;height:26px;display:flex;align-items:center;justify-content:center;border-radius:50%;background:var(--bg4);color:var(--t3);font-size:.65rem;flex-shrink:0;transition:all var(--tr);border:1px solid transparent}
.row-gmb:hover{background:var(--gold);color:var(--bg);border-color:var(--gold)}

/* Grid view */
.grid-wrap{flex:1;overflow-y:auto;padding:.8rem 1rem;display:none}
.grid-wrap.vis{display:block}
.grid{display:grid;gap:.7rem;grid-template-columns:repeat(auto-fill,minmax(240px,1fr))}
.gc{background:var(--card);border:1px solid var(--card-b);border-radius:var(--r2);overflow:hidden;cursor:pointer;transition:all var(--tr);position:relative}
.gc:hover{background:var(--card-h);border-color:#252535;transform:translateY(-2px);box-shadow:var(--sh)}
.gc.top-m{border-left:3px solid var(--gold)}.gc.bad-m{border-left:3px solid var(--red)}
.gc-photo{width:100%;height:110px;object-fit:cover;background:var(--bg4)}
.gc-nophoto{width:100%;height:50px;background:linear-gradient(135deg,var(--bg3),var(--bg4));display:flex;align-items:center;justify-content:center;font-size:1.2rem;opacity:.2}
.gc-body{padding:.65rem .75rem}
.gc-top{display:flex;justify-content:space-between;align-items:flex-start;gap:.4rem;margin-bottom:.2rem}
.gc-name{font-weight:700;font-size:.8rem;line-height:1.25;flex:1}
.gc-rat{font-weight:800;font-size:.82rem;flex-shrink:0}
.gc-addr{font-size:.64rem;color:var(--t3);margin-bottom:.35rem}
.gc-footer{display:flex;align-items:center;gap:.35rem;flex-wrap:wrap}
.gc-rev{font-size:.6rem;color:var(--t4)}
.gc-link{position:absolute;top:.4rem;right:.4rem;width:24px;height:24px;display:flex;align-items:center;justify-content:center;background:rgba(5,5,7,.7);border-radius:50%;color:var(--t2);font-size:.6rem;opacity:0;transition:opacity var(--tr)}
.gc:hover .gc-link{opacity:1}

/* Rankings drawer */
.rkd{position:fixed;top:52px;right:0;bottom:0;width:320px;background:rgba(8,8,12,.96);backdrop-filter:blur(16px);border-left:1px solid #1a1a28;z-index:160;transform:translateX(100%);transition:transform .25s ease;overflow-y:auto}
.rkd.open{transform:translateX(0)}
.rkd-h{padding:.8rem 1rem;border-bottom:1px solid #1a1a28;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;background:rgba(8,8,12,.96);z-index:2}
.rkd-t{font-family:var(--fd);font-size:1.1rem;color:var(--gold)}
.rkd-x{background:none;border:none;color:var(--t3);cursor:pointer;font-size:1.1rem}
.rkd-b{padding:.6rem}
.rks{margin-bottom:.8rem}
.rks-t{font-size:.62rem;text-transform:uppercase;letter-spacing:.08em;color:var(--t4);padding:.2rem .4rem;font-weight:700}
.rki{display:flex;align-items:center;gap:.4rem;padding:.35rem .4rem;border-radius:var(--r);cursor:pointer;transition:background var(--tr);font-size:.72rem}
.rki:hover{background:var(--bg4)}
.rki-p{width:20px;height:20px;display:flex;align-items:center;justify-content:center;font-size:.6rem;font-weight:700;border-radius:50%;background:var(--gold3);color:var(--gold);flex-shrink:0}
.rki-p.g{background:var(--gold);color:var(--bg)}
.rki-n{flex:1;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.rki-v{color:var(--gold);font-weight:700}

.rkbtn{position:fixed;bottom:1.2rem;right:1.2rem;z-index:155;padding:.5rem .9rem;font-size:.7rem;font-weight:600;background:var(--bg3);border:1px solid var(--gold2);border-radius:20px;color:var(--gold);cursor:pointer;font-family:var(--ff);box-shadow:var(--sh);display:none}
.rkbtn.vis{display:block}
.rkbtn:hover{background:var(--gold3)}

/* Responsive */
@media(max-width:900px){
  .sidebar{transform:translateX(-260px)}.sidebar.mob-open{transform:translateX(0)}
  .sb-toggle{display:flex}
  .content{margin-left:0}
  .minimap-wrap.big{inset:56px 0 0 0}
  .rkd{width:100%}
}
@media(max-width:600px){
  .grid{grid-template-columns:repeat(auto-fill,minmax(160px,1fr))}
  .topbar{padding:.5rem .8rem}
}
</style>
</head>
<body>
<div id="LD"><h1>Z√ºriHub</h1><div class="b"><div class="f"></div></div></div>

<nav class="nav">
  <div class="nav-brand" onclick="location.reload()">Z√ºriHub<span>Gastronomie ¬∑ Kanton Z√ºrich</span></div>
  <div class="nav-r">
    <div class="nav-stat" id="navStat"></div>
  </div>
</nav>

<div class="app">
  <aside class="sidebar" id="sidebar">
    <!-- Search -->
    <div class="sb-section">
      <div class="sb-title">Suche</div>
      <input class="sb-search" id="qSearch" placeholder="Name, K√ºche, Keyword‚Ä¶" oninput="apply()">
    </div>
    <!-- Category -->
    <div class="sb-section">
      <div class="sb-title">Kategorie <span class="sb-clear" onclick="clearCat()">Reset</span></div>
      <div class="sb-chips" id="catChips"></div>
    </div>
    <!-- Cuisine -->
    <div class="sb-section">
      <div class="sb-title">K√ºche <span class="sb-clear" onclick="clearCuisine()">Reset</span></div>
      <div class="sb-chips" id="cuisineChips"></div>
    </div>
    <!-- Location -->
    <div class="sb-section">
      <div class="sb-title">Standort <span class="sb-clear" onclick="clearLoc()">Reset</span></div>
      <input class="sb-search" id="qLoc" placeholder="Gemeinde oder Kreis filtern‚Ä¶" oninput="filterLocChips()" style="margin-bottom:.4rem">
      <div class="sb-chips" id="locChips"></div>
    </div>
    <!-- Stars -->
    <div class="sb-section">
      <div class="sb-title">Bewertung <span class="sb-clear" onclick="clearStars()">Reset</span></div>
      <div class="sb-chips" id="starChips">
        <button class="chip" data-s="4.5" onclick="tStar(4.5,this)">‚òÖ 4.5+</button>
        <button class="chip" data-s="4" onclick="tStar(4,this)">‚òÖ 4+</button>
        <button class="chip" data-s="3" onclick="tStar(3,this)">‚òÖ 3+</button>
        <button class="chip" data-s="2" onclick="tStar(2,this)">‚òÖ 2+</button>
        <button class="chip red" data-s="0" onclick="tStar(0,this)">‚òÖ < 2</button>
      </div>
    </div>
  </aside>

  <button class="sb-toggle" id="sbToggle" onclick="toggleSidebar()">‚ò∞</button>

  <main class="content">
    <div class="topbar">
      <div class="topbar-l">
        <div class="topbar-count" id="tCount">0 <span>Betriebe</span></div>
      </div>
      <div class="topbar-r">
        <select class="sort-sel" id="sortSel" onchange="apply()">
          <option value="rating-desc">Beste Bewertung</option>
          <option value="rating-asc">Schlechteste</option>
          <option value="reviews-desc">Meiste Bewertungen</option>
          <option value="reviews-asc">Wenigste Bewertungen</option>
          <option value="name-asc">Name A‚ÄìZ</option>
        </select>
        <button class="vbtn on" id="vList" onclick="setView('list')">‚ò∞</button>
        <button class="vbtn" id="vGrid" onclick="setView('grid')">‚ñ¶</button>
        <button class="vbtn" id="vMap" onclick="toggleMap()">üó∫</button>
      </div>
    </div>
    <div class="minimap-wrap" id="mmWrap">
      <button class="exp" onclick="toggleMapBig()">‚§¢</button>
      <div id="mmap"></div>
    </div>
    <div class="list-wrap" id="listWrap"></div>
    <div class="grid-wrap" id="gridWrap"><div class="grid" id="grid"></div></div>
  </main>
</div>

<div class="rkd" id="rkd">
  <div class="rkd-h"><div class="rkd-t">üèÜ Ranglisten</div><button class="rkd-x" onclick="toggleRk()">‚úï</button></div>
  <div class="rkd-b" id="rkBody"></div>
</div>
<button class="rkbtn vis" id="rkBtn" onclick="toggleRk()">üèÜ Ranglisten</button>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Z√ºriHub v3 ‚Äì Professional Gastro Hub
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const D={data:null,all:[],filtered:[],map:null,markers:[],mapsReady:false,
  catFilter:new Set(),cuisineFilter:new Set(),locFilter:new Set(),starFilter:null,
  view:'list',rkOpen:false,mapVis:false,mapBig:false};

// Z√ºrich Kreise Zuordnung (Postleitzahlen)
const KREISE={
  'Kreis 1':['8001'],'Kreis 2':['8002','8038'],'Kreis 3':['8003','8045'],
  'Kreis 4':['8004'],'Kreis 5':['8005'],'Kreis 6':['8006'],
  'Kreis 7':['8006','8032','8044'],'Kreis 8':['8008'],
  'Kreis 9':['8048','8047'],'Kreis 10':['8037','8049'],
  'Kreis 11':['8050','8051','8052'],'Kreis 12':['8053','8055'],
};
const PLZ_KREIS={};
Object.entries(KREISE).forEach(([k,plzs])=>plzs.forEach(p=>{PLZ_KREIS[p]=k}));

// K√ºchen-Klassifikation
const CUISINE_KW={
  'Italienisch':['italian','pizz','pasta','risotto','trattoria','osteria','ristorante','gelat'],
  'T√ºrkisch':['t√ºrk','tuerk','kebab','d√∂ner','doner','ocakbasi','lahmacun','pide','baklava','turkish'],
  'Japanisch':['japan','sushi','ramen','udon','izakaya','miso','tempura','sashimi'],
  'Thail√§ndisch':['thai','pad thai','tom yam','curry thai'],
  'Chinesisch':['chines','china','dim sum','peking','wok','szechuan','canton'],
  'Indisch':['indi','curry','tandoori','naan','masala','biryani','paneer'],
  'Griechisch':['griech','greek','gyros','souvlaki','taverna','moussaka'],
  'Mexikanisch':['mexik','mexican','taco','burrito','nachos','enchilada','guacamole'],
  'Vietnamesisch':['vietnam','pho','bahn mi','spring roll'],
  'Koreanisch':['korean','kimchi','bibimbap','bulgogi','kbbq'],
  'Libanesisch':['liban','lebanes','hummus','falafel','shawarma','mezze','tabouleh'],
  'Amerikanisch':['burger','american','bbq','barbecue','steak','ribs','wings'],
  'Franz√∂sisch':['fran√ßais','french','brasserie','bistro','cr√™pe','croissant'],
  'Spanisch':['spanisch','spanish','tapas','paella','sangria'],
  'Vegetarisch/Vegan':['vegan','vegetar','plant based','pflanzlich','bio k√ºche'],
  'Schweizer K√ºche':['schweiz','swiss','fondue','raclette','r√∂sti','z√ºrcher'],
};

function classifyCuisine(name, types) {
  const n = (name || '').toLowerCase();
  const found = [];
  for (const [cuisine, kws] of Object.entries(CUISINE_KW)) {
    for (const kw of kws) { if (n.includes(kw)) { found.push(cuisine); break; } }
  }
  return found.length > 0 ? found : ['Andere'];
}

function extractLocation(addr) {
  if (!addr) return { gemeinde: 'Unbekannt', kreis: null };
  // Extract PLZ
  const plzMatch = addr.match(/(\d{4})/);
  const plz = plzMatch ? plzMatch[1] : null;
  const kreis = plz ? PLZ_KREIS[plz] || null : null;
  // Extract city name after PLZ
  const cityMatch = addr.match(/\d{4}\s+([^,]+)/);
  let gemeinde = cityMatch ? cityMatch[1].trim() : 'Unbekannt';
  // Normalize Z√ºrich
  if (gemeinde.toLowerCase().startsWith('z√ºrich') || gemeinde.toLowerCase().startsWith('zurich')) gemeinde = 'Z√ºrich';
  return { gemeinde, kreis, plz };
}

function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML}
function rc(r){if(r>=4.5)return'var(--gold)';if(r>=3.5)return'var(--green)';if(r>=2.5)return'var(--t2)';return'var(--red)'}
function starsStr(r){let s='';for(let i=0;i<Math.floor(r);i++)s+='‚òÖ';if(r-Math.floor(r)>=.3)s+='¬Ω';return s}

// ‚îÄ‚îÄ Data Loading ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function init(){
  try{
    const r=await fetch('data/gastro.json');
    if(!r.ok)throw 0;
    D.data=await r.json();
  }catch(e){D.data=genDemo()}

  // Enrich data
  D.data.places.forEach(p=>{
    const loc=extractLocation(p.address);
    p._gemeinde=loc.gemeinde;
    p._kreis=loc.kreis;
    p._plz=loc.plz;
    p._cuisines=classifyCuisine(p.name, p.types);
    p._searchText=(p.name+' '+p.address+' '+p.trade+' '+p._cuisines.join(' ')+' '+(p._kreis||'')+' '+p._gemeinde).toLowerCase();
  });
  D.all=D.data.places;
  document.getElementById('navStat').textContent=D.all.length+' Betriebe';

  buildCatChips();
  buildCuisineChips();
  buildLocChips();
  apply();
  buildRankings();
  if(D.mapsReady)initMap();
  setTimeout(()=>document.getElementById('LD').classList.add('out'),600);
}

// ‚îÄ‚îÄ Build filter chips ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildCatChips(){
  const cats={};D.all.forEach(p=>{cats[p.trade]=(cats[p.trade]||0)+1});
  const c=document.getElementById('catChips');
  let h='';
  Object.entries(cats).sort((a,b)=>b[1]-a[1]).forEach(([t,n])=>{
    h+=`<button class="chip" data-cat="${esc(t)}" onclick="tCat('${esc(t)}',this)">${esc(t)}<span class="n">${n}</span></button>`;
  });
  c.innerHTML=h;
}

function buildCuisineChips(){
  const cs={};D.all.forEach(p=>p._cuisines.forEach(c=>{cs[c]=(cs[c]||0)+1}));
  const el=document.getElementById('cuisineChips');
  let h='';
  Object.entries(cs).sort((a,b)=>b[1]-a[1]).forEach(([c,n])=>{
    if(c==='Andere'||n<3)return;
    h+=`<button class="chip" data-cui="${esc(c)}" onclick="tCuisine('${esc(c)}',this)">${esc(c)}<span class="n">${n}</span></button>`;
  });
  el.innerHTML=h;
}

function buildLocChips(){
  const locs={};
  D.all.forEach(p=>{
    locs[p._gemeinde]=(locs[p._gemeinde]||0)+1;
    if(p._kreis)locs[p._kreis]=(locs[p._kreis]||0)+1;
  });
  renderLocChips(locs,'');
}

function renderLocChips(locs,q){
  const el=document.getElementById('locChips');
  let h='';
  const sorted=Object.entries(locs).sort((a,b)=>b[1]-a[1]);
  const filtered=q?sorted.filter(([k])=>k.toLowerCase().includes(q)):sorted;
  filtered.slice(0,30).forEach(([l,n])=>{
    const on=D.locFilter.has(l)?'on':'';
    h+=`<button class="chip ${on}" data-loc="${esc(l)}" onclick="tLoc('${esc(l)}',this)">${esc(l)}<span class="n">${n}</span></button>`;
  });
  el.innerHTML=h;
}

function filterLocChips(){
  const q=document.getElementById('qLoc').value.toLowerCase().trim();
  const locs={};
  D.all.forEach(p=>{
    locs[p._gemeinde]=(locs[p._gemeinde]||0)+1;
    if(p._kreis)locs[p._kreis]=(locs[p._kreis]||0)+1;
  });
  renderLocChips(locs,q);
}

// ‚îÄ‚îÄ Filter toggles ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function tCat(v,el){if(D.catFilter.has(v)){D.catFilter.delete(v);el.classList.remove('on')}else{D.catFilter.add(v);el.classList.add('on')}apply()}
function tCuisine(v,el){if(D.cuisineFilter.has(v)){D.cuisineFilter.delete(v);el.classList.remove('on')}else{D.cuisineFilter.add(v);el.classList.add('on')}apply()}
function tLoc(v,el){if(D.locFilter.has(v)){D.locFilter.delete(v);el.classList.remove('on')}else{D.locFilter.add(v);el.classList.add('on')}apply()}
function tStar(v,el){const w=el.classList.contains('on');document.querySelectorAll('#starChips .chip').forEach(c=>c.classList.remove('on'));if(w)D.starFilter=null;else{D.starFilter=v;el.classList.add('on')}apply()}
function clearCat(){D.catFilter.clear();document.querySelectorAll('#catChips .chip').forEach(c=>c.classList.remove('on'));apply()}
function clearCuisine(){D.cuisineFilter.clear();document.querySelectorAll('#cuisineChips .chip').forEach(c=>c.classList.remove('on'));apply()}
function clearLoc(){D.locFilter.clear();document.querySelectorAll('#locChips .chip').forEach(c=>c.classList.remove('on'));apply()}
function clearStars(){D.starFilter=null;document.querySelectorAll('#starChips .chip').forEach(c=>c.classList.remove('on'));apply()}

// ‚îÄ‚îÄ Apply filters + sort + render ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function apply(){
  let p=[...D.all];
  const q=document.getElementById('qSearch').value.toLowerCase().trim();
  if(q)p=p.filter(x=>x._searchText.includes(q));
  if(D.catFilter.size>0)p=p.filter(x=>D.catFilter.has(x.trade));
  if(D.cuisineFilter.size>0)p=p.filter(x=>x._cuisines.some(c=>D.cuisineFilter.has(c)));
  if(D.locFilter.size>0)p=p.filter(x=>D.locFilter.has(x._gemeinde)||D.locFilter.has(x._kreis));
  if(D.starFilter!==null){if(D.starFilter===0)p=p.filter(x=>x.rating<2);else p=p.filter(x=>x.rating>=D.starFilter)}

  const sv=document.getElementById('sortSel').value;
  const cmp={'rating-desc':(a,b)=>b.rating-a.rating||b.reviewCount-a.reviewCount,'rating-asc':(a,b)=>a.rating-b.rating,'reviews-desc':(a,b)=>b.reviewCount-a.reviewCount,'reviews-asc':(a,b)=>a.reviewCount-b.reviewCount,'name-asc':(a,b)=>a.name.localeCompare(b.name,'de')};
  p.sort(cmp[sv]||cmp['rating-desc']);

  D.filtered=p;
  document.getElementById('tCount').innerHTML=`${p.length} <span>von ${D.all.length} Betrieben</span>`;
  render();
  renderMarkers();
}

function render(){
  if(D.view==='list')renderList();
  else renderGrid();
}

function renderList(){
  document.getElementById('listWrap').style.display='';
  document.getElementById('gridWrap').classList.remove('vis');
  const rk=D.data.rankings||{};const topIds=new Set(),badIds=new Set();
  Object.values(rk).forEach(r=>{(r.top_rated||[]).forEach(id=>topIds.add(id));(r.worst_rated||[]).forEach(id=>badIds.add(id))});
  const el=document.getElementById('listWrap');
  let h='';
  D.filtered.forEach((pl,i)=>{
    const isTop=topIds.has(pl.id),isBad=badIds.has(pl.id);
    const gmb=pl.gmapsUrl||'#';
    const photo=pl.photos&&pl.photos[0]?`<img class="row-photo" src="${esc(pl.photos[0])}" alt="" loading="lazy" onerror="this.outerHTML='<div class=row-no-photo>üìç</div>'">`:'<div class="row-no-photo">üìç</div>';
    const locBadge=pl._kreis?`<span class="badge badge-loc">${esc(pl._kreis)}</span>`:(pl._gemeinde!=='Z√ºrich'&&pl._gemeinde!=='Unbekannt'?`<span class="badge badge-loc">${esc(pl._gemeinde)}</span>`:'');
    const cuisineBadges=pl._cuisines.filter(c=>c!=='Andere').map(c=>`<span class="badge badge-cuisine">${esc(c)}</span>`).join('');
    h+=`<div class="row" onclick="window.open('${esc(gmb)}','_blank')">
      <div class="row-rank">${i+1}</div>
      ${photo}
      <div class="row-info">
        <div class="row-name">${esc(pl.name)}</div>
        <div class="row-addr">${esc(pl.address)}</div>
        <div class="row-badges">
          <span class="badge badge-cat">${esc(pl.trade)}</span>
          ${cuisineBadges}${locBadge}
          ${isTop?'<span class="badge badge-top">TOP</span>':''}
          ${isBad?'<span class="badge badge-bad">WARNUNG</span>':''}
        </div>
      </div>
      <div class="row-rating">
        <div class="row-stars" style="color:${rc(pl.rating)}">${pl.rating.toFixed(1)}</div>
        <div class="row-reviews">${pl.reviewCount.toLocaleString('de-CH')} Bew.</div>
      </div>
      <a class="row-gmb" href="${esc(gmb)}" target="_blank" rel="noopener" onclick="event.stopPropagation()" title="Google Maps">‚Üó</a>
    </div>`;
  });
  if(D.filtered.length===0)h='<div style="padding:3rem;text-align:center;color:var(--t3)">Keine Betriebe gefunden.</div>';
  el.innerHTML=h;
}

function renderGrid(){
  document.getElementById('listWrap').style.display='none';
  document.getElementById('gridWrap').classList.add('vis');
  const rk=D.data.rankings||{};const topIds=new Set(),badIds=new Set();
  Object.values(rk).forEach(r=>{(r.top_rated||[]).forEach(id=>topIds.add(id));(r.worst_rated||[]).forEach(id=>badIds.add(id))});
  const el=document.getElementById('grid');
  let h='';
  D.filtered.forEach(pl=>{
    const isTop=topIds.has(pl.id),isBad=badIds.has(pl.id);
    const cls=['gc'];if(isTop)cls.push('top-m');if(isBad)cls.push('bad-m');
    const gmb=pl.gmapsUrl||'#';
    const photo=pl.photos&&pl.photos[0]?`<img class="gc-photo" src="${esc(pl.photos[0])}" alt="" loading="lazy" onerror="this.outerHTML='<div class=gc-nophoto>üìç</div>'">`:'<div class="gc-nophoto">üìç</div>';
    h+=`<div class="${cls.join(' ')}" onclick="window.open('${esc(gmb)}','_blank')">
      <a class="gc-link" href="${esc(gmb)}" target="_blank" rel="noopener" onclick="event.stopPropagation()">‚Üó</a>
      ${photo}<div class="gc-body"><div class="gc-top"><div class="gc-name">${esc(pl.name)}</div><div class="gc-rat" style="color:${rc(pl.rating)}">${pl.rating.toFixed(1)}</div></div>
      <div class="gc-addr">${esc(pl.address)}</div>
      <div class="gc-footer"><span class="gc-rev">${pl.reviewCount.toLocaleString('de-CH')} Bew.</span><span class="badge badge-cat">${esc(pl.trade)}</span>
      ${pl._cuisines.filter(c=>c!=='Andere').map(c=>`<span class="badge badge-cuisine">${esc(c)}</span>`).join('')}
      ${isTop?'<span class="badge badge-top">TOP</span>':''}${isBad?'<span class="badge badge-bad">WARNUNG</span>':''}</div></div></div>`;
  });
  if(D.filtered.length===0)h='<div style="grid-column:1/-1;padding:3rem;text-align:center;color:var(--t3)">Keine Betriebe gefunden.</div>';
  el.innerHTML=h;
}

// ‚îÄ‚îÄ View toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setView(v){
  D.view=v;
  document.getElementById('vList').classList.toggle('on',v==='list');
  document.getElementById('vGrid').classList.toggle('on',v==='grid');
  render();
}

// ‚îÄ‚îÄ Map ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleMap(){D.mapVis=!D.mapVis;document.getElementById('mmWrap').classList.toggle('vis',D.mapVis);if(D.mapVis&&!D.map&&D.mapsReady)initMap();if(D.map)google.maps.event.trigger(D.map,'resize')}
function toggleMapBig(){D.mapBig=!D.mapBig;document.getElementById('mmWrap').classList.toggle('big',D.mapBig);setTimeout(()=>{if(D.map)google.maps.event.trigger(D.map,'resize')},100)}
function initMap(){
  if(D.map)return;
  D.map=new google.maps.Map(document.getElementById('mmap'),{
    center:{lat:47.3769,lng:8.5417},zoom:10,
    styles:[{elementType:"geometry",stylers:[{color:"#12121c"}]},{elementType:"labels.text.stroke",stylers:[{color:"#12121c"}]},{elementType:"labels.text.fill",stylers:[{color:"#3a3a55"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#1a1a2c"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#080810"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]}],
    disableDefaultUI:true,zoomControl:true,gestureHandling:'cooperative'
  });
  renderMarkers();
}
function renderMarkers(){
  if(!D.map)return;D.markers.forEach(m=>m.setMap(null));D.markers=[];
  const bounds=new google.maps.LatLngBounds();
  const max=Math.min(D.filtered.length,600);
  for(let i=0;i<max;i++){const pl=D.filtered[i];if(!pl.lat||!pl.lng)continue;
    const pos={lat:pl.lat,lng:pl.lng};bounds.extend(pos);
    let c;if(pl.rating>=4.5)c='#d4a84a';else if(pl.rating>=3.5)c='#45b468';else if(pl.rating>=2)c='#888';else c='#e05555';
    const m=new google.maps.Marker({position:pos,map:D.map,title:pl.name,icon:{path:google.maps.SymbolPath.CIRCLE,scale:4,fillColor:c,fillOpacity:.8,strokeColor:'#000',strokeWeight:1}});
    m.addListener('click',()=>window.open(pl.gmapsUrl||'#','_blank'));D.markers.push(m)}
  if(max>0)D.map.fitBounds(bounds,20);
}

// ‚îÄ‚îÄ Sidebar toggle (mobile) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('mob-open')}

// ‚îÄ‚îÄ Rankings ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleRk(){D.rkOpen=!D.rkOpen;document.getElementById('rkd').classList.toggle('open',D.rkOpen)}
function buildRankings(){
  const rk=D.data.rankings||{};const pm={};D.data.places.forEach(p=>{pm[p.id]=p});
  let h='';
  Object.entries(rk).sort((a,b)=>b[1].total-a[1].total).forEach(([trade,d])=>{
    if(d.total<3)return;
    h+=`<div class="rks"><div class="rks-t">üèÜ ${esc(trade)}</div>`;
    (d.top_rated||[]).slice(0,5).forEach((id,i)=>{const p=pm[id];if(!p)return;
      h+=`<div class="rki" onclick="window.open('${esc(p.gmapsUrl||'#')}','_blank')"><div class="rki-p ${i===0?'g':''}">${i+1}</div><div class="rki-n">${esc(p.name)}</div><div class="rki-v">${p.rating.toFixed(1)}</div></div>`;});
    h+='</div>';});
  document.getElementById('rkBody').innerHTML=h||'<div style="padding:2rem;text-align:center;color:var(--t3)">Keine Rankings</div>';
}

// ‚îÄ‚îÄ Google Maps init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initGM(){document.getElementById('gms').src=`https://maps.googleapis.com/maps/api/js?key=${window.GMAPS_KEY}&callback=onGM`}
window.onGM=function(){D.mapsReady=true;if(D.mapVis)initMap()};

// ‚îÄ‚îÄ Demo data ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function genDemo(){
  const zh=[{d:"8001 Z√ºrich",la:47.3710,lo:8.5390},{d:"8002 Z√ºrich",la:47.3630,lo:8.5290},{d:"8003 Z√ºrich",la:47.3650,lo:8.5250},{d:"8004 Z√ºrich",la:47.3750,lo:8.5280},{d:"8005 Z√ºrich",la:47.3880,lo:8.5210},{d:"8006 Z√ºrich",la:47.3790,lo:8.5500},{d:"8008 Z√ºrich",la:47.3550,lo:8.5530},{d:"8032 Z√ºrich",la:47.3720,lo:8.5620},{d:"8037 Z√ºrich",la:47.3950,lo:8.4980},{d:"8045 Z√ºrich",la:47.3500,lo:8.5150},{d:"8048 Z√ºrich",la:47.3830,lo:8.4850},{d:"8050 Z√ºrich",la:47.4110,lo:8.5440},{d:"8051 Z√ºrich",la:47.4050,lo:8.5650},{d:"8400 Winterthur",la:47.4975,lo:8.7290},{d:"8600 D√ºbendorf",la:47.3973,lo:8.6184},{d:"8700 K√ºsnacht",la:47.3180,lo:8.5830},{d:"8953 Dietikon",la:47.4045,lo:8.4001},{d:"8610 Uster",la:47.3472,lo:8.7217},{d:"8620 Wetzikon",la:47.3267,lo:8.7978},{d:"8180 B√ºlach",la:47.5200,lo:8.5400}];
  const names={Restaurant:["Kronenhalle","Zeughauskeller","Hiltl","Clouds","Le D√©zaley","Alpenrose","Raclette Stube","Helvetia","Brasserie Lipp","Bindella","Holy Cow","Thai Garden","Zum Kropf","Volkshaus","Casa Ferlin","Rigiblick","Zunfthaus zur Waag","Markthalle","Razzia","Nooba","Miss Miu","Maison Manesse","Frau Gerolds Garten","LaSalle","Neni","Igniv","Spaghetti Factory","Blaue Ente","Caduff's","L√∂weneck","Sonnenberg","Josef","Giesserei","Rosaly's","Sein","Haus zum R√ºden","Ziegel Oh Lac","Ristorante Orsini","Linde Oberstrass","Bausch√§nzli","Wirtschaft Neumarkt","Pumpstation","Eden Garden","Pavillon","Accademia","Gambrinus","Quartino","T√ºfi","Umami","Fork & Bottle","Tot√≤","Pastarazzi","Rosi","M√ºnsterhof","Sablier","Didi's Frieden","Karl der Grosse","B√ºrgli","Commihalle","El Lokal","Drei Stuben","Heug√ºmper","Johanniter","Steakhouse Grill","M√®re Catherine","Outback Lodge","Waid","Vivat","Haute","Coco","Terrasse"],Bar:["Bar am Wasser","Old Crow","Widder Bar","Dante","Tales Bar","Shamrock","Clouds Bar","Jade Bar","Fritz","Gerold Bar","Kasheme","Hive","Jules Verne","Cinchona","Nietturm","Purpur","St√ºssihof","Pony Bar","Odeon Bar","Raygrodski","Labor Bar","Rimini Bar","Sph√®res","Werk 8","Dachkantine","Gonzo","Helsinki","Bazillus","Floor 64","Toni Bar","Xtra Bar","Z√§hringer","Icon","El Internado","Frieda's B√ºxe","Ol√© Ol√©","TapTab","Vinyl"],"Caf√©":["Spr√ºngli","Schober","Caf√© Odeon","Kafi Dihei","Milchbar","Vicaf√©","Mame","Henrici","Bor√©al Coffee","Mir√≥","Nini","Wunderbar","Xocolat","Birdie","Ella","Josefine","Nordbr√ºcke","Prado","Viadukt Caf√©","Coffee Circle","Stoll","Pl√ºsch","Kafischnaps","Kafi Franz","DiVino","George","Il Caff√®","Lotti","Maxwell","Tobi","Urban","Quai","Sch√º√ºr","Zentraleck","Fr√ºhling","Helvti","Auer & Co","Certo","Kiosk"],Takeaway:["Yooji's","Negishi","Sternen Grill","Poke House","Dean & David","√Ñss-Bar","Kebab Station","Falafel King","Ramen Shop","Wok Star","Burrito Rico","D√∂ner Box","El Sabor","Green Point","Sushi Mania","Mango Thai","Orient Express","Pizza Taxi","Street Food Box","Taco Loco","Udon House","Vegan Kitchen","Yummy Box","Quick Bites","Lunchbox","Karma Food","City Wok","Al Forno","Istanbul Grill","Jade Wok","House of Sushi"],"B√§ckerei":["Buchmann","Stocker","Fleischli","Steiner Beck","John Baker","Sutter Begg","Hausb√§ckerei","Brotmacher","Ofenfrisch","Pane Vivo","Maison Blunt","Kleiner Beck","Richi's","Gn√§dinger","Kloter","Alpenbrot","Goldkorn","Kornhaus","Landb√§ckerei","Naturb√§ck","R√∂sli","Spycher","Vollkorn Weber"],Hotel:["Baur au Lac","Dolder Grand","Widder Hotel","Storchen","Schweizerhof","Marriott","Hyatt","25hours","Park Hyatt","B2 Boutique","Atlantis","Greulich","Florhof","Seidenhof","Kindli","Glockenhof","Helmhaus","Seefeld","Limmathof","Marta"]};
  const places=[];let idx=0;
  Object.entries(names).forEach(([trade,list])=>{list.forEach(name=>{
    const loc=zh[Math.floor(Math.random()*zh.length)];
    places.push({id:`d${idx}`,name,address:`${['Bahnhof','Limmat','See','Berg','Kirch','Markt','Haupt','L√∂wen','M√ºhle','Rathaus'][Math.floor(Math.random()*10)]}strasse ${1+Math.floor(Math.random()*99)}, ${loc.d}`,
      lat:loc.la+(Math.random()-.5)*.02,lng:loc.lo+(Math.random()-.5)*.03,
      rating:Math.round((1+Math.random()*4)*10)/10,reviewCount:40+Math.floor(Math.random()*3000),
      gmapsUrl:`https://www.google.com/maps/search/${encodeURIComponent(name+' Z√ºrich')}`,
      website:'',phone:'',photos:[],trade,types:[],hours:[],businessStatus:'OPERATIONAL'});idx++})});
  const rankings={};[...new Set(places.map(p=>p.trade))].forEach(trade=>{const tp=places.filter(p=>p.trade===trade);const best=[...tp].sort((a,b)=>b.rating-a.rating||b.reviewCount-a.reviewCount);const worst=[...tp].sort((a,b)=>a.rating-b.rating);const most=[...tp].sort((a,b)=>b.reviewCount-a.reviewCount);rankings[trade]={total:tp.length,top_rated:best.slice(0,10).map(p=>p.id),worst_rated:worst.slice(0,10).map(p=>p.id),most_reviewed:most.slice(0,10).map(p=>p.id)}});
  return{metadata:{generated:new Date().toISOString(),minReviews:40,region:'Kanton Z√ºrich',category:'gastro',totalResults:places.length},rankings,places};
}

const _f=window.fetch;window.fetch=async function(u,...a){try{const r=await _f(u,...a);if(r.ok)return r;throw 0}catch(e){if(String(u).includes('gastro.json'))return new Response(JSON.stringify(genDemo()),{status:200,headers:{'Content-Type':'application/json'}});throw e}};

document.addEventListener('DOMContentLoaded',()=>{initGM();init()});
</script>
</body>
</html>
